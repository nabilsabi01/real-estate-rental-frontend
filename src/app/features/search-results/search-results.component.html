<app-header [isScrolled]="isScrolled" [currentSection]="currentSection"></app-header>

<main class="search-results container-fluid" role="main">
  <div class="row">
    <div class="col-md-3">
      <div class="filter-sidebar">
        <h3>Filters</h3>
        <div class="filter-section">
          <h4>Price Range</h4>
          <input type="range" class="form-range" [(ngModel)]="priceRange[1]" min="0" max="1000" step="10">
          <p>${{priceRange[0]}} - ${{priceRange[1]}}</p>
        </div>
        <div class="filter-section">
          <h4>Property Type</h4>
          <div *ngFor="let type of propertyTypes" class="form-check">
            <input class="form-check-input" type="checkbox" [(ngModel)]="selectedPropertyTypes" [id]="type">
            <label class="form-check-label" [for]="type">{{type}}</label>
          </div>
        </div>
        <div class="filter-section">
          <h4>Amenities</h4>
          <div *ngFor="let amenity of amenities" class="form-check">
            <input class="form-check-input" type="checkbox" [(ngModel)]="selectedAmenities" [id]="amenity">
            <label class="form-check-label" [for]="amenity">{{amenity}}</label>
          </div>
        </div>
        <button class="btn btn-primary w-100" (click)="applyFilters()">Apply Filters</button>
      </div>
    </div>
    <div class="col-md-9">
      <app-search-bar></app-search-bar>
      
      <div *ngIf="loading" class="loading">Loading...</div>
      
      <div *ngIf="error" class="error alert alert-danger">{{ error }}</div>
      
      <div class="property-list" *ngIf="!loading && !error">
        <div class="property-card card mb-3" *ngFor="let property of properties">
          <div class="row g-0">
            <div class="col-md-4">
              <div id="property{{property.id}}Carousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                  <div class="carousel-item" *ngFor="let photo of property.photos; let i = index" [class.active]="i === 0">
                    <img [src]="photo.photoUrl" class="d-block w-100" [alt]="property.title">
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" [attr.data-bs-target]="'#property' + property.id + 'Carousel'" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" [attr.data-bs-target]="'#property' + property.id + 'Carousel'" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
            </div>
            <div class="col-md-8">
              <div class="card-body">
                <h5 class="card-title">{{ property.title }}</h5>
                <p class="card-text">{{ property.location.city }}, {{ property.location.country }}</p>
                <p class="card-text"><small class="text-muted">{{ property.pricePerNight | currency }} per night</small></p>
                <div class="d-flex justify-content-between align-items-center">
                  <button class="btn btn-primary">View Details</button>
                  <button class="btn btn-outline-primary" (click)="toggleFavorite(property)">
                    <i class="bi" [ngClass]="property.isFavorited ? 'bi-heart-fill' : 'bi-heart'"></i>
                    {{ property.isFavorited ? 'Favorited' : 'Add to Favorites' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <mat-paginator 
        [length]="totalElements"
        [pageSize]="pageSize"
        [pageSizeOptions]="[5, 10, 25, 100]"
        (page)="onPageChange($event)"
        aria-label="Select page">
      </mat-paginator>
    </div>
  </div>
</main>

<app-footer></app-footer>